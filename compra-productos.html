<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finalizar Compra - Modern Home</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Header y Navbar -->
    <header>
        <nav class="navbar">
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="Productos.html">Productos</a></li>
                <li><a href="IniciaSesion.html">Inicia Sesión</a></li>
            </ul>
        </nav>
    </header>

    <!-- Sección de Finalizar Compra -->
    <main>
        <section class="carrito-section">
            <h2>Finalizar Compra</h2>
            <div class="facturacion-card">
                <h3>Facturación</h3>
                <div class="facturacion-content">
                    <div class="facturacion-info">
                        <h4>Modern Home</h4>
                        <ul id="carrito-lista">
                            <!-- Productos seleccionados se llenarán aquí -->
                        </ul>
                        <p>Total: $<span id="total">0</span></p>
                    </div>
                    <div class="facturacion-metodo">
                        <h4>Método de Pago</h4>
                        <form id="payment-form">
                            <label>
                                <input type="radio" name="metodo-pago" value="tarjeta" required>
                                Tarjeta de Crédito/Débito
                            </label><br>
                            <label>
                                <input type="radio" name="metodo-pago" value="paypal">
                                PayPal
                            </label><br>
                            <label>
                                <input type="radio" name="metodo-pago" value="efectivo">
                                Efectivo
                            </label>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Tarjeta Animada para Tarjeta de Crédito/Débito -->
            <div id="tarjeta-pago">
                <h3>Detalles de Pago</h3>
                <div class="flip-card">
                    <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <p class="heading_8264">MASTERCARD</p>
                            <svg class="logo" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="36" height="36" viewBox="0 0 48 48">
                                <path fill="#ff9800" d="M32 10A14 14 0 1 0 32 38A14 14 0 1 0 32 10Z"></path>
                                <path fill="#d50000" d="M16 10A14 14 0 1 0 16 38A14 14 0 1 0 16 10Z"></path>
                                <path fill="#ff3d00" d="M18,24c0,4.755,2.376,8.95,6,11.48c3.624-2.53,6-6.725,6-11.48s-2.376-8.95-6-11.48 C20.376,15.05,18,19.245,18,24z"></path>
                            </svg>
                            <svg version="1.1" class="chip" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="30px" height="30px" viewBox="0 0 50 50" xml:space="preserve">
                                <image id="image0" width="50" height="50" x="0" y="0" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAABGdBTUEAALGPC/xhBQAAACBjSFJN
                                  AAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAB6VBMVEUAAACNcTiVeUKVeUOY
                                  fEaafEeUeUSYfEWZfEaykleyklaXe0SWekSZZjOYfEWYe0WXfUWXe0WcgEicfkiXe0SVekSXekSW
                                  ekKYe0a9nF67m12ZfUWUeEaXfESVekOdgEmVeUWWekSniU+VeUKVeUOrjFKYfEWliE6WeESZe0GS
                                  e0WYfES7ml2Xe0WXfESUeEOWfEWcf0eWfESXe0SXfEWYekSVeUKXfEWxklawkVaZfEWWekOUekOW
                                  ekSYfESZe0eXekWYfEWZe0WZe0eVeUSWeETAnmDCoWLJpmbxy4P1zoXwyoLIpWbjvXjivnjgu3bf
                                  u3beunWvkFWxkle/nmDivXiWekTnwXvkwHrCoWOuj1SXe0TEo2TDo2PlwHratnKZfEbQrWvPrWua
                                  fUfbt3PJp2agg0v0zYX0zYSfgkvKp2frxX7mwHrlv3rsxn/yzIPgvHfduXWXe0XuyIDzzISsjVO1
                                  lVm0lFitjVPzzIPqxX7duna0lVncuHTLqGjvyIHeuXXxyYGZfUayk1iyk1e2lln1zYTEomO2llrb
                                  tnOafkjFpGSbfkfZtXLhvHfkv3nqxH3mwXujhU3KqWizlFilh06khk2fgkqsjlPHpWXJp2erjVOh
                                  g0yWe0SliE+XekShhEvAn2D///+gx8TWAAAARnRSTlMACVCTtsRl7Pv7+vxkBab7pZv5+ZlL/UnU
                                  /f3SJCVe+Fx39naA9/75XSMh0/3SSkia+pil/KRj7Pr662JPkrbP7OLQ0JFOijI1MwAAAAFiS0dE
                                  orDd34wAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfnAg0IEzgIwaKTAAADDklEQVRYw+1XS0iUURQ+f5qPyjQf
                                  lGRFEEFK76koKGxRbWyVVLSOgsCgwjZBJJYuKogSIoOonUK4q3U0WVBWFPZYiIE6kuArG3VGzK/F
                                  fPeMM/MLt99/NuHdfPd888/57jn3nvsQWWj/VcMlvMMd5KRTogqx9iCdIjUUmcGR9ImUYowyP3xN
                                  GQJoRLVaZ2DaZf8kyjEJALhI28ELioyiwC+Rc3QZwRYyO/DH51hQgWm6DMIh10KmD4u9O16K49it
                                  VoPOAmcGAWWOepXIRScAoJZ2Frro8oN+EyTT6lWkkg6msZfMSR35QTJmjU0g15tIGSJ08ZZMJkJk
                                  HpNZgSkyXosS13TkJpZ62mPIJvOSzC1bp8vRhhCakEk7G9/o4gmZdbpsTcKu0m63FbnBP9Qrc15z
                                  bkbemfgNDtEOI8NO5L5O9VYyRYgmJayZ9nPaxZrSjW4+F6Uw9yQqIiIZwhp2huQTf6OIvCZyGM6g
                                  DJBZbyXifJXr7FZjGXsdxADxI7HUJFB6iWvsIhFpkoiIiGTJfjJfiCuJg2ZEspq9EHGVpYgzKqwJ
                                  qSAOEwuJQ/pxPvE3cYltJCLdxBLiSKKIE5HxJKcTRNeadxfhDiuYw44zVs1dxKwRk/uCxIiQkxKB
                                  sSctRVAge9g1E15EHE6yRUaJecRxcWlukdRIbGFOSZCMWQA/iWauIP3slREHXPyliqBcrrD71Amz
                                  Z+rD1Mt2Yr8TZc/UR4/YtFnbijnHi3UrN9vKQ9rPaJf867ZiaqDB+czeKYmd3pNa6fuI75MiC0uX
                                  XSR5aEMf7s7a6r/PudVXkjFb/SsrCRfROk0Fx6+H1i9kkTGn/E1vEmt1m089fh+RKdQ5O+xNJPUi
                                  cUIjO0Dm7HwvErEr0YxeibL1StSh37STafE4I7zcBdRq1DiOkdmlTJVnkQTBTS7X1FYyvfO4piaI
                                  nKbDCDaT2anLudYXCRFsQBgAcIF2/Okwgvz5+Z4tsw118dzruvIvjhTB+HOuWy8UvovEH6beitBK
                                  xDyxm9MmISKCWrzB7bSlaqGlsf0FC0gMjzTg6GgAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDIt
                                  MTNUMDg6MTk6NTYrMDA6MDCjlq7LAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTAyLTEzVDA4OjE5
                                  OjU2KzAwOjAw0ssWdwAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyMy0wMi0xM1QwODoxOTo1Nisw
                                  MDowMIXeN6gAAAAASUVORK5CYII=" />
                            </svg>
                            <p class="number">9759 2484 5269 6576</p>
                            <p class="valid_thru">VALID THRU</p>
                            <p class="date_8264">12 / 24</p>
                            <p class="name">BRUCE WAYNE</p>
                        </div>
                        <div class="flip-card-back">
                            <div class="strip"></div>
                            <div class="mstrip"></div>
                            <div class="sstrip">
                              <p class="code">***</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Formulario de Tarjeta de Crédito/Débito -->
                <div id="card-form">
                    <form id="payment-details-form">
                        <div>
                            <label for="nombre-tarjeta">Nombre en la Tarjeta:</label>
                            <input type="text" id="nombre-tarjeta" name="nombre-tarjeta" required>
                        </div>
                        <div>
                            <label for="numero-tarjeta">Número de Tarjeta:</label>
                            <input type="text" id="numero-tarjeta" name="numero-tarjeta" required maxlength="19" placeholder="1234 5678 9012 3456">
                        </div>
                        <div style="display: flex; gap: 20px;">
                            <div>
                                <label for="expiracion">Expiración:</label>
                                <input type="text" id="expiracion" name="expiracion" required placeholder="MM/AA" maxlength="5">
                            </div>
                            <div>
                                <label for="cvv">CVV:</label>
                                <input type="text" id="cvv" name="cvv" required maxlength="3">
                            </div>
                        </div>
                        <button type="submit" class="btn">Procesar Pago</button>
                    </form>
                </div>
            </div>

            <!-- PayPal Formulario -->
            <div id="paypal-form" style="display: none; margin-top: 40px;">
                <h3>Pago con PayPal</h3>
                <p>Serás redirigido a PayPal para completar tu pago.</p>
                <button id="btn-paypal" class="btn">Pagar con PayPal</button>
            </div>

            <!-- QR para Pago en Efectivo -->
            <div id="qr-efectivo" style="display: none; margin-top: 40px;">
                <h3>Pago en Efectivo</h3>
                <p>Escanea el siguiente código QR para completar tu pago en efectivo.</p>
                <div id="qrcode-efectivo"></div>
            </div>

            <!-- Mensaje de Éxito -->
            <div id="mensaje-exito" style="display: none; margin-top: 40px; text-align: center;">
                <h3>¡Compra exitosa!</h3>
                <p>Pase a la sucursal más cercana para recoger su producto.</p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2024 Modern Home. Esta página es ficticia con fines escolares, no lucrativa.</p>
    </footer>

    <!-- Scripts -->
    <!-- Incluir la librería QRCode.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <script>
    // Inicializa el carrito desde localStorage o como un array vacío
    let carrito = JSON.parse(localStorage.getItem('carrito')) || [];

    // Objeto de productos para mapear productoId a detalles
    const productos = {
        1: { nombre: "Sofá Moderno", precio: 12000 },
        2: { nombre: "Mesa de Centro", precio: 3500 },
        3: { nombre: "Mesa de Comedor", precio: 9000 },
        4: { nombre: "Sillas de Comedor", precio: 4500 }
        // Añade más productos según tu catálogo
    };

    // Función para actualizar la interfaz del carrito en la página de compra
    function actualizarCarritoCompra() {
        const listaCarrito = document.getElementById('carrito-lista');
        const total = document.getElementById('total');
        listaCarrito.innerHTML = '';
        let sumaTotal = 0;

        carrito.forEach((item, index) => {
            const producto = productos[item.productoId];
            if (producto) {
                const li = document.createElement('li');
                li.textContent = `${producto.nombre} - $${producto.precio}`;
                listaCarrito.appendChild(li);
                sumaTotal += producto.precio;
            }
        });

        total.textContent = sumaTotal;
    }

    // Función para manejar la selección del método de pago
    function manejarMetodoPago() {
        const radios = document.getElementsByName('metodo-pago');
        const tarjetaPago = document.getElementById('tarjeta-pago');
        const cardForm = document.getElementById('card-form');
        const paypalForm = document.getElementById('paypal-form');
        const qrEfectivo = document.getElementById('qr-efectivo');
        const mensajeExito = document.getElementById('mensaje-exito');

        radios.forEach(radio => {
            radio.addEventListener('change', () => {
                // Ocultar todos los formularios inicialmente
                tarjetaPago.style.display = 'none';
                cardForm.style.display = 'none';
                paypalForm.style.display = 'none';
                qrEfectivo.style.display = 'none';
                mensajeExito.style.display = 'none';

                console.log(`Método de pago seleccionado: ${radio.value}`); // Debugging

                if (radio.value === 'tarjeta') {
                    tarjetaPago.style.display = 'block';
                    cardForm.style.display = 'block';
                } else if (radio.value === 'paypal') {
                    paypalForm.style.display = 'block';
                } else if (radio.value === 'efectivo') {
                    qrEfectivo.style.display = 'block';
                    generarQREfectivo();
                }
            });
        });
    }

    // Función para manejar el envío del formulario de pago
    function manejarEnvioPago() {
        const formPagoTarjeta = document.getElementById('payment-details-form');
        const btnPaypal = document.getElementById('btn-paypal');
        const mensajeExito = document.getElementById('mensaje-exito');

        // Manejar envío del formulario de tarjeta
        formPagoTarjeta.addEventListener('submit', (e) => {
            e.preventDefault();
            console.log('Formulario de tarjeta enviado'); // Debugging
            // Aquí puedes agregar la lógica para procesar el pago con tarjeta
            // Por ahora, simularemos el pago exitoso
            mostrarMensajeExito();
            // Limpiar el carrito después del pago
            carrito = [];
            localStorage.setItem('carrito', JSON.stringify(carrito));
            actualizarCarritoCompra();
        });

        // Manejar botón de PayPal
        btnPaypal.addEventListener('click', () => {
            console.log('Botón de PayPal clickeado'); // Debugging
            // Aquí puedes agregar la lógica para redirigir a PayPal
            // Por ahora, simularemos el pago exitoso
            mostrarMensajeExito();
            // Limpiar el carrito después del pago
            carrito = [];
            localStorage.setItem('carrito', JSON.stringify(carrito));
            actualizarCarritoCompra();
        });
    }

    // Función para mostrar el mensaje de éxito
    function mostrarMensajeExito() {
        const tarjetaPago = document.getElementById('tarjeta-pago');
        const cardForm = document.getElementById('card-form');
        const paypalForm = document.getElementById('paypal-form');
        const qrEfectivo = document.getElementById('qr-efectivo');
        const mensajeExito = document.getElementById('mensaje-exito');

        // Ocultar todos los formularios
        tarjetaPago.style.display = 'none';
        cardForm.style.display = 'none';
        paypalForm.style.display = 'none';
        qrEfectivo.style.display = 'none';

        // Mostrar mensaje de éxito
        mensajeExito.style.display = 'block';
    }

    // Función para actualizar la tarjeta animada en tiempo real
    function actualizarTarjetaAnimada() {
        const nombreTarjetaInput = document.getElementById('nombre-tarjeta');
        const numeroTarjetaInput = document.getElementById('numero-tarjeta');
        const expiracionInput = document.getElementById('expiracion');
        const cvvInput = document.getElementById('cvv');

        const nombreTarjeta = document.querySelector('.flip-card .name');
        const numeroTarjeta = document.querySelector('.flip-card .number');
        const expiracion = document.querySelector('.flip-card .date_8264');

        nombreTarjetaInput.addEventListener('input', () => {
            nombreTarjeta.textContent = nombreTarjetaInput.value.toUpperCase() || "BRUCE WAYNE";
        });

        numeroTarjetaInput.addEventListener('input', () => {
            numeroTarjeta.textContent = numeroTarjetaInput.value || "9759 2484 5269 6576";
        });

        expiracionInput.addEventListener('input', () => {
            expiracion.textContent = expiracionInput.value || "12 / 24";
        });

        // Opcional: Puedes agregar eventos para CVV o cualquier otro campo si lo deseas
    }

    // Función para generar el QR para pago en efectivo
    function generarQREfectivo() {
        const total = document.getElementById('total').textContent;
        const qrcodeEfectivo = document.getElementById("qrcode-efectivo");
        qrcodeEfectivo.innerHTML = ""; // Limpiar QR existente si hay alguno

        try {
            new QRCode(qrcodeEfectivo, {
                text: `Pago Efectivo: $${total}`,
                width: 128,
                height: 128,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });
            console.log('QR generado correctamente'); // Debugging
        } catch (error) {
            console.error('Error al generar el QR:', error);
        }
    }

    // Inicializar las funciones al cargar la página
    document.addEventListener('DOMContentLoaded', () => {
        actualizarCarritoCompra();
        manejarMetodoPago();
        manejarEnvioPago();
        actualizarTarjetaAnimada();
    });
    </script>

</body>
</html>
